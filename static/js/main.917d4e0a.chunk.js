(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{5343:function(e,t,n){e.exports=n(5516)},5516:function(e,t,n){"use strict";n.r(t);var a=n(24),r=n(1),c=n.n(r),l=n(35),i=n.n(l),o=n(16),u=n(42),s=n(4),m=n(13),d=n(123),f=n(121),p=n(122),E=n(124),h=(n(5348),n(5540)),b=n(5537),g=n(25),v=n(26),y=n(29),O=n(27),j=n(60),w=n(28),k=n(5519),I=n(5520),C=n(5522),S=n(5523),$=n(5524),x=n(5539),N=n(5525),P=n(5526),D=n(5518),M="/",F=n(113),T=n.n(F)()({basename:"/upis"}),q=function(e){localStorage.removeItem("token"),e.resetStore(),T.push("/login")},U=function(){return c.a.createElement(o.a,null,function(e){return c.a.createElement(D.a,{onClick:function(){return q(e)}},"Sign Out")})},A=n(5521),L=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(y.a)(this,Object(O.a)(t).call(this,e))).toggle=n.toggle.bind(Object(j.a)(n)),n.state={isOpen:!1},n}return Object(w.a)(t,e),Object(v.a)(t,[{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement(k.a,{color:"light",light:!0,expand:"md"},c.a.createElement(I.a,null,c.a.createElement(A.a,{to:"/"},"upis")),c.a.createElement(C.a,{onClick:this.toggle}),c.a.createElement(S.a,{isOpen:this.state.isOpen,navbar:!0},c.a.createElement($.a,{className:"ml-auto",navbar:!0},c.a.createElement(x.a,{nav:!0,inNavbar:!0},c.a.createElement(N.a,{nav:!0,caret:!0}),c.a.createElement(P.a,{right:!0},c.a.createElement(D.a,null,c.a.createElement(A.a,{to:"/"},"Faculties")),this.props.session&&this.props.session.me&&"ADMIN"===this.props.session.me.role?c.a.createElement(r.Fragment,null,c.a.createElement(D.a,null,c.a.createElement(A.a,{to:"/account"},"Profile")),c.a.createElement(D.a,{divider:!0}),c.a.createElement(D.a,null,c.a.createElement(U,null,"Log Out"))):c.a.createElement(r.Fragment,null,c.a.createElement(D.a,null,c.a.createElement(A.a,{to:"/login"},"Login")))))))))}}]),t}(r.Component),Q=n(47),z=n(5529),B=n(5530),J=n(118),G=n(5527),H=n(5528),R=function(e){var t=e.faculty;return c.a.createElement("div",null,c.a.createElement(G.a,{color:"primary",pill:!0},t.name),c.a.createElement(H.a,{responsive:!0,hover:!0},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"#"),c.a.createElement("th",null,"Department"),c.a.createElement("th",null,"Total"),c.a.createElement("th",null,"Budget"),c.a.createElement("th",null,"Self-financing"))),c.a.createElement("tbody",null,t.departments.map(function(e,t){return c.a.createElement("tr",{key:e.id},c.a.createElement("th",{scope:"row"},t+1),Object.keys(e).map(function(t){switch(t){case"name":case"total":return c.a.createElement("td",{key:t,className:"department".concat(t[0].toUpperCase()).concat(t.slice(1))},e[t]);case"budget":case"selfFinancing":return c.a.createElement("td",{key:t,className:"department".concat(t[0].toUpperCase()).concat(t.slice(1))},e[t]);default:return""}}))}))))},Y=n(21),K=n(22),V=n.n(K);function W(){var e=Object(Y.a)(["\n  subscription {\n    departmentUpdated {\n      department {\n        id\n        name\n        total\n        budget\n        selfFinancing\n      }\n    }\n  }\n"]);return W=function(){return e},e}var X=V()(W()),Z=function(e){function t(){var e,n;Object(g.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(y.a)(this,(e=Object(O.a)(t)).call.apply(e,[this].concat(r)))).subscribeToMore=function(){n.props.subscribeToMore({document:X,updateQuery:function(e,t){return t.subscriptionData.data,e}})},n}return Object(w.a)(t,e),Object(v.a)(t,[{key:"componentDidMount",value:function(){this.subscribeToMore()}},{key:"render",value:function(){return this.props.faculties.map(function(e){return c.a.createElement(R,{key:e.id,faculty:e})})}}]),t}(r.Component);function _(){var e=Object(Y.a)(["\n  query($cursor: String, $limit: Int!) {\n    faculties(cursor: $cursor, limit: $limit) {\n      edges {\n        id\n        name\n        createdAt\n        departments {\n          id\n          name\n          total\n          budget\n          selfFinancing\n        }\n      }\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n    }\n  }\n"]);return _=function(){return e},e}var ee=V()(_()),te=function(e){var t=e.limit,n=e.pageInfo,r=e.fetchMore,l=e.children;return c.a.createElement(J.a,{color:"secondary",onClick:function(){return r({variables:{cursor:n.endCursor,limit:t},updateQuery:function(e,t){var n=t.fetchMoreResult;return n?{faculties:Object(a.a)({},n.faculties,{edges:[].concat(Object(Q.a)(e.faculties.edges),Object(Q.a)(n.faculties.edges))})}:e}})}},l)},ne=function(e){var t=e.limit;return c.a.createElement("div",null,c.a.createElement(z.a,null,c.a.createElement(o.d,{query:ee,variables:{limit:t}},function(e){var n=e.data,a=e.loading,l=(e.error,e.fetchMore),i=e.subscribeToMore;if(!n)return c.a.createElement("div",null,"There are no faculties...");var o=n.faculties;if(a||!o)return c.a.createElement("div",null,c.a.createElement(B.a,{color:"primary"}));var u=o.edges,s=o.pageInfo;return c.a.createElement(r.Fragment,null,c.a.createElement(Z,{faculties:u,subscribeToMore:i}),s.hasNextPage&&c.a.createElement(te,{limit:t,pageInfo:s,fetchMore:l},"More"))})))},ae=function(){return c.a.createElement("div",null,c.a.createElement(ne,{limit:2}))},re=n(31),ce=n.n(re),le=n(46),ie=n(59),oe=n(5541),ue=n(119),se=function(e){var t=e.error;return c.a.createElement("div",null,c.a.createElement("small",null,t.message))},me=n(5531),de=n(5532),fe=n(5533),pe=n(5534),Ee=n(5535),he=n(5536);function be(){var e=Object(Y.a)(["\n  mutation($login: String!, $password: String!) {\n    signIn(login: $login, password: $password) {\n      token\n    }\n  }\n"]);return be=function(){return e},e}var ge=V()(be()),ve={login:"",password:""},ye=function(e){function t(){var e,n;Object(g.a)(this,t);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return(n=Object(y.a)(this,(e=Object(O.a)(t)).call.apply(e,[this].concat(c)))).state=Object(a.a)({},ve),n.onChange=function(e){var t=e.target,a=t.name,r=t.value;n.setState(Object(ie.a)({},a,r))},n.onSubmit=function(e,t){t().then(function(){var e=Object(le.a)(ce.a.mark(function e(t){var r;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.data,n.setState(Object(a.a)({},ve)),localStorage.setItem("token",r.signIn.token),e.next=5,n.props.refetch();case 5:n.props.history.push(M);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.preventDefault()},n}return Object(w.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.login,a=t.password,r=a.length<7||!Object(ue.isEmail)(n);return c.a.createElement(o.c,{mutation:ge,variables:{login:n,password:a}},function(t,l){l.data;var i=l.loading,o=l.error;return c.a.createElement(me.a,{onSubmit:function(n){return e.onSubmit(n,t)}},c.a.createElement(de.a,{form:!0},c.a.createElement(fe.a,{md:6,lg:{size:3,offset:2}},c.a.createElement(pe.a,null,c.a.createElement(Ee.a,{for:"userEmail"},"Email"),c.a.createElement(he.a,{name:"login",value:n,onChange:e.onChange,type:"email",id:"userEmail",placeholder:"Email or Username"}))),c.a.createElement(fe.a,{md:6,lg:{size:3,offset:2}},c.a.createElement(Ee.a,{for:"userPassword"},"Password"),c.a.createElement(he.a,{name:"password",value:a,onChange:e.onChange,type:"password",id:"userPassword",placeholder:"Password"})),c.a.createElement(fe.a,{md:6,lg:{size:3,offset:2}},c.a.createElement("p",{className:"lead"},c.a.createElement(J.a,{disabled:r||i,type:"submit"},"Sign In"))),o&&c.a.createElement(se,{error:o})))})}}]),t}(r.Component),Oe=Object(oe.a)(function(e){var t=e.history,n=e.refetch;return c.a.createElement("div",null,c.a.createElement(z.a,null,c.a.createElement("h1",{className:"display-3 text-center"},"Login"),c.a.createElement(ye,{history:t,refetch:n})))}),je=n(80);function we(){var e=Object(Y.a)(["\n  mutation($id: ID!, $attribute: String!, $facultyId: ID!) {\n    downPlace(id: $id, attribute: $attribute, facultyId: $facultyId) {\n      id\n      name\n      total\n      budget\n      selfFinancing\n    }\n  }\n"]);return we=function(){return e},e}function ke(){var e=Object(Y.a)(["\n  mutation($id: ID!, $attribute: String!, $facultyId: ID!) {\n    upPlace(id: $id, attribute: $attribute, facultyId: $facultyId) {\n      id\n      name\n      total\n      budget\n      selfFinancing\n    }\n  }\n"]);return ke=function(){return e},e}var Ie=V()(ke()),Ce=V()(we()),Se=function(e){function t(e){var n;return Object(g.a)(this,t),(n=Object(y.a)(this,Object(O.a)(t).call(this,e))).upPlace=function(){var e=Object(le.a)(ce.a.mark(function e(t,r){var c,l,i,o;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:c=e.sent,l=c.data,i=l.upPlace,(o=n.state.departments)[t]=Object(a.a)({},i),n.setState({departments:o});case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),n.downPlace=function(){var e=Object(le.a)(ce.a.mark(function e(t,r,c){var l,i,o,u;return ce.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((l=n.state.departments)[t][r]<=0)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,c();case 5:i=e.sent,o=i.data,u=o.downPlace,l[t]=Object(a.a)({},u),n.setState({departments:l});case 10:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),n.state={departments:Object(Q.a)(n.props.faculty.departments)},n}return Object(w.a)(t,e),Object(v.a)(t,[{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement(G.a,{color:"primary",pill:!0},this.props.faculty.name),c.a.createElement(H.a,{responsive:!0,hover:!0},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"#"),c.a.createElement("th",null,"Department"),c.a.createElement("th",null,"Total"),c.a.createElement("th",null,"Budget"),c.a.createElement("th",null,"Self-financing"))),c.a.createElement("tbody",null,this.props.faculty.departments.map(function(t,n){return c.a.createElement("tr",{key:t.id},c.a.createElement("th",{scope:"row"},n+1),Object.keys(t).map(function(a){switch(a){case"name":case"total":return c.a.createElement("td",{key:a,className:"department".concat(a[0].toUpperCase()).concat(a.slice(1))},e.state.departments[n][a]);case"budget":case"selfFinancing":return c.a.createElement("td",{key:a,className:"department".concat(a[0].toUpperCase()).concat(a.slice(1))},e.props.session&&e.props.session.me?c.a.createElement(o.c,{mutation:Ie,variables:{id:t.id,attribute:a,facultyId:e.props.faculty.id}},function(t,a){a.data,a.loading,a.error;return c.a.createElement(je.b,{onClick:function(){return e.upPlace(n,t)}})}):"",e.state.departments[n][a],e.props.session&&e.props.session.me?c.a.createElement(o.c,{mutation:Ce,variables:{id:t.id,attribute:a,facultyId:e.props.faculty.id}},function(t,r){r.data,r.loading,r.error;return c.a.createElement(je.a,{onClick:function(){return e.downPlace(n,a,t)}})}):"");default:return""}}))}))))}}]),t}(r.Component);function $e(){var e=Object(Y.a)(["\n  query($id: ID!) {\n    faculty(id: $id) {\n      id\n      name\n      departments {\n        id\n        name\n        total\n        budget\n        selfFinancing\n      }\n    }\n  }\n"]);return $e=function(){return e},e}var xe=V()($e()),Ne=n(5538);function Pe(){var e=Object(Y.a)(["\n  {\n    me {\n      id\n      username\n      email\n      role\n      faculty {\n        id\n      }\n    }\n  }\n"]);return Pe=function(){return e},e}var De=V()(Pe()),Me=function(e){return function(t){return function(n){return c.a.createElement(o.d,{query:De},function(a){var r=a.data;return a.networkStatus<7?null:e(r)?c.a.createElement(t,n):c.a.createElement(Ne.a,{to:"/login"})})}}}(function(e){return e.me&&"ADMIN"===e.me.role})(function(e){var t=e.session;return c.a.createElement("div",null,c.a.createElement(o.d,{query:xe,variables:{id:t.me.faculty.id}},function(e){var n=e.data,a=e.loading,l=n.faculty;return a||!l?c.a.createElement("div",null,c.a.createElement(B.a,{color:"primary"})):c.a.createElement(r.Fragment,null,c.a.createElement(Se,{key:l.id,session:t,faculty:l}))}))}),Fe=function(e){return function(t){return c.a.createElement(o.d,{query:De},function(n){var a=n.data,r=n.refetch;return c.a.createElement(e,Object.assign({},t,{session:a,refetch:r}))})}}(function(e){var t=e.session,n=e.refetch;return c.a.createElement(h.a,{history:T},c.a.createElement("div",null,c.a.createElement(L,{session:t}),c.a.createElement("hr",null),c.a.createElement(b.a,{exact:!0,path:M,component:function(){return c.a.createElement(ae,null)}}),c.a.createElement(b.a,{exact:!0,path:"/login",component:function(){return c.a.createElement(Oe,{refetch:n})}}),c.a.createElement(b.a,{exact:!0,path:"/account",component:function(){return c.a.createElement(Me,{session:t})}})))}),Te=new d.a({uri:"http://localhost:8080/graphql"}),qe=new f.a({uri:"ws://localhost:8080/graphql",options:{reconnect:!0}}),Ue=Object(m.d)(function(e){var t=e.query,n=Object(s.k)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},qe,Te),Ae=new m.a(function(e,t){return e.setContext(function(e){var t=e.headers,n=void 0===t?{}:t,r=localStorage.getItem("token");return r&&(n=Object(a.a)({},n,{"x-token":r})),{headers:n}}),t(e)}),Le=Object(p.a)(function(e){var t=e.graphQLErrors,n=e.networkError;t&&t.forEach(function(e){var t=e.message;e.locations,e.path;console.log("GraphQL error",t),"UNAUTHENTICATED"!==t&&"Your session expired. Sign in again."!==t||q(Be)}),n&&(console.log("Network error",n),401===n.statusCode&&q(Be))}),Qe=m.a.from([Ae,Le,Ue]),ze=new E.a,Be=new u.a({link:Qe,cache:ze});i.a.render(c.a.createElement(o.b,{client:Be},c.a.createElement(Fe,null)),document.getElementById("root"))}},[[5343,1,2]]]);
//# sourceMappingURL=main.917d4e0a.chunk.js.map