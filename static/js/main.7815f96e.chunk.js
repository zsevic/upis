(this.webpackJsonpupis=this.webpackJsonpupis||[]).push([[0],{114:function(e,t,n){e.exports=n(234)},234:function(e,t,n){"use strict";n.r(t);var a=n(21),r=n(0),c=n.n(r),l=n(52),o=n.n(l),i=n(17),u=n(36),s=n(5),m=n(18),d=n(112),f=n(109),p=n(110),E=n(111),b=(n(119),n(16)),h=n(29),v=n(30),g=n(53),y=n(34),O=n(33),j=n(249),k=n(250),w=n(251),S=n(252),C=n(253),I=n(267),T=n(268),D=n(269),P=n(248),N=n(100),_=n.n(N)()({basename:"/upis"}),x=function(e){localStorage.removeItem("token"),e.resetStore(),_.push("/login")},$=function(){return c.a.createElement(i.a,null,(function(e){return c.a.createElement(P.a,{onClick:function(){return x(e)}},"Sign Out")}))},A=n(32),M=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).toggle=a.toggle.bind(Object(g.a)(a)),a.state={isOpen:!1},a}return Object(v.a)(n,[{key:"toggle",value:function(){this.setState({isOpen:!this.state.isOpen})}},{key:"render",value:function(){return c.a.createElement("div",null,c.a.createElement(j.a,{color:"light",light:!0,expand:"md"},c.a.createElement(k.a,null,c.a.createElement(A.a,{to:"/"},"upis")),c.a.createElement(w.a,{onClick:this.toggle}),c.a.createElement(S.a,{isOpen:this.state.isOpen,navbar:!0},c.a.createElement(C.a,{className:"ml-auto",navbar:!0},c.a.createElement(I.a,{nav:!0,inNavbar:!0},c.a.createElement(T.a,{nav:!0,caret:!0}),c.a.createElement(D.a,{right:!0},c.a.createElement(P.a,null,c.a.createElement(A.a,{to:"/"},"Faculties")),this.props.session&&this.props.session.me&&"ADMIN"===this.props.session.me.role?c.a.createElement(r.Fragment,null,c.a.createElement(P.a,null,c.a.createElement(A.a,{to:"/account"},"Profile")),c.a.createElement(P.a,{divider:!0}),c.a.createElement(P.a,null,c.a.createElement($,null,"Log Out"))):c.a.createElement(r.Fragment,null,c.a.createElement(P.a,null,c.a.createElement(A.a,{to:"/login"},"Login")))))))))}}]),n}(r.Component),U=n(43),F=n(256),q=n(257),L=n(101),R=n(266),W=n(104),B=n.n(W),K=n(254),H=n(255),Q=function(e){var t=e.faculty;return c.a.createElement("div",null,c.a.createElement(K.a,{color:"primary",pill:!0},t.name),c.a.createElement(K.a,{color:"danger",pill:!0},t.counter),c.a.createElement(H.a,{responsive:!0,hover:!0},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"#"),c.a.createElement("th",null,"Department"),c.a.createElement("th",null,"Total"),c.a.createElement("th",null,"Budget"),c.a.createElement("th",null,"Self-financing"))),c.a.createElement("tbody",null,t.departments.map((function(e,t){return c.a.createElement("tr",{key:e.id},c.a.createElement("th",{scope:"row"},t+1),Object.keys(e).map((function(t){switch(t){case"name":case"total":return c.a.createElement("td",{key:t,className:"department".concat(t[0].toUpperCase()).concat(t.slice(1))},e[t]);case"budget":case"selfFinancing":return c.a.createElement("td",{key:t,className:"department".concat(t[0].toUpperCase()).concat(t.slice(1))},e[t]);default:return""}})))})))))},V=n(24),z=n(25),J=n.n(z);function G(){var e=Object(V.a)(["\n  subscription {\n    facultyUpdated {\n      faculty {\n        id\n        name\n        counter\n        createdAt\n        departments {\n          id\n          name\n          total\n          budget\n          selfFinancing\n        }\n      }\n    }\n  }\n"]);return G=function(){return e},e}var Y=J()(G()),X=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return(e=t.call.apply(t,[this].concat(c))).subscribeToMore=function(){e.props.subscribeToMore({document:Y,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var r=n.data.facultyUpdated;return Object(a.a)(Object(a.a)({},e),{},{faculties:Object(a.a)(Object(a.a)({},e.faculties),{},{edges:[r.faculty].concat(Object(U.a)(e.faculties.edges))})})}})},e}return Object(v.a)(n,[{key:"componentDidMount",value:function(){this.subscribeToMore()}},{key:"render",value:function(){var e=this.props.faculties;return B.a.uniqBy(e,"id").map((function(e){return c.a.createElement(Q,{key:e.id,faculty:e})}))}}]),n}(r.Component);function Z(){var e=Object(V.a)(["\n  query($cursor: String, $limit: Int!) {\n    faculties(cursor: $cursor, limit: $limit) {\n      edges {\n        id\n        name\n        counter\n        createdAt\n        departments {\n          id\n          name\n          total\n          budget\n          selfFinancing\n        }\n      }\n      pageInfo {\n        hasNextPage\n        endCursor\n      }\n    }\n  }\n"]);return Z=function(){return e},e}var ee=J()(Z()),te=function(e){var t=e.limit,n=e.pageInfo,r=e.fetchMore,l=e.children;return c.a.createElement(L.a,{color:"secondary",onClick:function(){return r({variables:{cursor:n.endCursor,limit:t},updateQuery:function(e,t){var n=t.fetchMoreResult;return n?{faculties:Object(a.a)(Object(a.a)({},n.faculties),{},{edges:[].concat(Object(U.a)(e.faculties.edges),Object(U.a)(n.faculties.edges))})}:e}})}},l)},ne=function(e){var t=e.limit;return c.a.createElement("div",null,c.a.createElement(F.a,null,c.a.createElement(R.b,{query:ee,variables:{limit:t}},(function(e){var n=e.data,a=e.loading,l=(e.error,e.fetchMore),o=e.subscribeToMore;if(!n)return c.a.createElement("div",null,"Network error...");var i=n.faculties;if(a||!i)return c.a.createElement("div",null,c.a.createElement(q.a,{color:"primary"}));var u=i.edges,s=i.pageInfo;return c.a.createElement(r.Fragment,null,c.a.createElement(X,{faculties:u,subscribeToMore:o}),s.hasNextPage&&c.a.createElement(te,{limit:t,pageInfo:s,fetchMore:l},"More"))}))))},ae=function(){return c.a.createElement("div",null,c.a.createElement(ne,{limit:2}))},re=n(37),ce=n.n(re),le=n(49),oe=n(108),ie=function(e){var t=e.error;return c.a.createElement("div",null,c.a.createElement("small",null,t.message))},ue=n(258),se=n(259),me=n(260),de=n(261),fe=n(262),pe=n(263);function Ee(){var e=Object(V.a)(["\n  mutation($login: String!, $password: String!) {\n    signIn(login: $login, password: $password) {\n      token\n    }\n  }\n"]);return Ee=function(){return e},e}var be=J()(Ee()),he={login:"",password:""},ve=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return(e=t.call.apply(t,[this].concat(c))).state=Object(a.a)({},he),e.onChange=function(t){var n=t.target,a=n.name,r=n.value;e.setState({[a]:r})},e.onSubmit=function(t,n){n().then(function(){var t=Object(le.a)(ce.a.mark((function t(n){var r;return ce.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.data,e.setState(Object(a.a)({},he)),localStorage.setItem("token",r.signIn.token),t.next=5,e.props.refetch();case 5:e.props.history.push("/");case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.preventDefault()},e}return Object(v.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.login,a=t.password,r=a.length<7||!Object(oe.isEmail)(n);return c.a.createElement(R.a,{mutation:be,variables:{login:n,password:a}},(function(t,l){l.data;var o=l.loading,i=l.error;return c.a.createElement(ue.a,{onSubmit:function(n){return e.onSubmit(n,t)}},c.a.createElement(se.a,{form:!0},c.a.createElement(me.a,{md:6,lg:{size:3,offset:2}},c.a.createElement(de.a,null,c.a.createElement(fe.a,{for:"userEmail"},"Email"),c.a.createElement(pe.a,{name:"login",value:n,onChange:e.onChange,type:"email",id:"userEmail",placeholder:"Email or Username"}))),c.a.createElement(me.a,{md:6,lg:{size:3,offset:2}},c.a.createElement(fe.a,{for:"userPassword"},"Password"),c.a.createElement(pe.a,{name:"password",value:a,onChange:e.onChange,type:"password",id:"userPassword",placeholder:"Password"})),c.a.createElement(me.a,{md:6,lg:{size:3,offset:2}},c.a.createElement("p",{className:"lead"},c.a.createElement(L.a,{disabled:r||o,type:"submit"},"Sign In"))),i&&c.a.createElement(ie,{error:i})))}))}}]),n}(r.Component),ge=Object(b.f)((function(e){var t=e.history,n=e.refetch;return c.a.createElement("div",null,c.a.createElement(F.a,null,c.a.createElement("h1",{className:"display-3 text-center"},"Login"),c.a.createElement(ve,{history:t,refetch:n})))})),ye=n(264),Oe=n(265);function je(){var e=Object(V.a)(["\n  mutation($facultyId: ID!) {\n    incrementCounter(facultyId: $facultyId) {\n      id\n      name\n      counter\n    }\n  }\n"]);return je=function(){return e},e}function ke(){var e=Object(V.a)(["\n  mutation($id: ID!, $attribute: String!, $facultyId: ID!) {\n    downPlace(id: $id, attribute: $attribute, facultyId: $facultyId) {\n      id\n      name\n      total\n      budget\n      selfFinancing\n    }\n  }\n"]);return ke=function(){return e},e}function we(){var e=Object(V.a)(["\n  query($id: ID!) {\n    faculty(id: $id) {\n      id\n      name\n      counter\n      departments {\n        id\n        name\n        total\n        budget\n        selfFinancing\n      }\n    }\n  }\n"]);return we=function(){return e},e}var Se=J()(we()),Ce=J()(ke()),Ie=J()(je()),Te=function(e){Object(y.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(h.a)(this,n),(r=t.call(this,e)).incrementCounter=function(){var e=Object(le.a)(ce.a.mark((function e(t){return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:r.setState({counter:r.state.counter+1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.downPlace=function(){var e=Object(le.a)(ce.a.mark((function e(t,n,c){var l,o,i,u;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((l=r.state.departments)[t][n]<=0)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,c();case 5:o=e.sent,i=o.data,u=i.downPlace,l[t]=Object(a.a)({},u),r.setState({departments:l,counter:r.state.counter+1});case 10:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),r.state={counter:r.props.faculty.counter,departments:Object(U.a)(r.props.faculty.departments)},r}return Object(v.a)(n,[{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement(K.a,{color:"primary",pill:!0},this.props.faculty.name),c.a.createElement(K.a,{color:"danger",pill:!0},this.state.counter," ",this.props.session.me?c.a.createElement(R.a,{mutation:Ie,variables:{facultyId:this.props.faculty.id}},(function(t,n){n.data,n.loading,n.error;return c.a.createElement(ye.a,{onClick:function(){return e.incrementCounter(t)}})})):""),c.a.createElement(H.a,{responsive:!0,hover:!0},c.a.createElement("thead",null,c.a.createElement("tr",null,c.a.createElement("th",null,"#"),c.a.createElement("th",null,"Department"),c.a.createElement("th",null,"Total"),c.a.createElement("th",null,"Budget"),c.a.createElement("th",null,"Self-financing"))),c.a.createElement("tbody",null,this.props.faculty.departments.map((function(t,n){return c.a.createElement("tr",{key:t.id},c.a.createElement("th",{scope:"row"},n+1),Object.keys(t).map((function(a){switch(a){case"name":case"total":return c.a.createElement("td",{key:a,className:"department".concat(a[0].toUpperCase()).concat(a.slice(1))},e.state.departments[n][a]);case"budget":case"selfFinancing":return c.a.createElement("td",{key:a,className:"department".concat(a[0].toUpperCase()).concat(a.slice(1))},e.state.departments[n][a],e.props.session&&e.props.session.me?c.a.createElement(R.a,{mutation:Ce,variables:{id:t.id,attribute:a,facultyId:e.props.faculty.id}},(function(t,r){r.data,r.loading,r.error;return c.a.createElement(Oe.a,{onClick:function(){return e.downPlace(n,a,t)}})})):"");default:return""}})))})))))}}]),n}(r.Component);function De(){var e=Object(V.a)(["\n  {\n    me {\n      id\n      username\n      email\n      role\n      faculty {\n        id\n      }\n    }\n  }\n"]);return De=function(){return e},e}var Pe=J()(De()),Ne=function(e){return function(t){return function(n){return c.a.createElement(R.b,{query:Pe},(function(a){var r=a.data;return a.networkStatus<7?null:e(r)?c.a.createElement(t,n):c.a.createElement(b.a,{to:"/login"})}))}}}((function(e){return e.me&&"ADMIN"===e.me.role}))((function(e){var t=e.session;return c.a.createElement("div",null,c.a.createElement(R.b,{query:Se,variables:{id:t.me.faculty.id}},(function(e){var n=e.data,a=e.loading,l=n.faculty;return a||!l?c.a.createElement("div",null,c.a.createElement(q.a,{color:"primary"})):c.a.createElement(r.Fragment,null,c.a.createElement(Te,{key:l.id,session:t,faculty:l}))})))})),_e=function(e){return function(t){return c.a.createElement(R.b,{query:Pe},(function(n){var a=n.data,r=n.refetch;return c.a.createElement(e,Object.assign({},t,{session:a,refetch:r}))}))}}((function(e){var t=e.session,n=e.refetch;return c.a.createElement(b.c,{history:_},c.a.createElement("div",null,c.a.createElement(M,{session:t}),c.a.createElement("hr",null),c.a.createElement(b.b,{exact:!0,path:"/",component:function(){return c.a.createElement(ae,null)}}),c.a.createElement(b.b,{exact:!0,path:"/login",component:function(){return c.a.createElement(ge,{refetch:n})}}),c.a.createElement(b.b,{exact:!0,path:"/account",component:function(){return c.a.createElement(Ne,{session:t})}})))})),xe=new d.a({uri:Object({NODE_ENV:"production",PUBLIC_URL:"/upis",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_DEVSERVER||"https://upis.herokuapp.com/graphql"}),$e=new f.a({uri:Object({NODE_ENV:"production",PUBLIC_URL:"/upis",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_WS||"wss://upis.herokuapp.com/graphql",options:{reconnect:!0}}),Ae=Object(m.d)((function(e){var t=e.query,n=Object(s.l)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r}),$e,xe),Me=new m.a((function(e,t){return e.setContext((function(e){var t=e.headers,n=void 0===t?{}:t,r=localStorage.getItem("token");return r&&(n=Object(a.a)(Object(a.a)({},n),{},{"x-token":r})),{headers:n}})),t(e)})),Ue=Object(p.a)((function(e){var t=e.graphQLErrors,n=e.networkError;t&&t.forEach((function(e){var t=e.message;e.locations,e.path;console.log("GraphQL error",t),"UNAUTHENTICATED"!==t&&"Your session expired. Sign in again."!==t||x(Le)})),n&&(console.log("Network error",n),401===n.statusCode?x(Le):(localStorage.removeItem("token"),Le.resetStore()))})),Fe=m.a.from([Me,Ue,Ae]),qe=new E.a,Le=new u.a({link:Fe,cache:qe});o.a.render(c.a.createElement(i.b,{client:Le},c.a.createElement(_e,null)),document.getElementById("root"))}},[[114,1,2]]]);
//# sourceMappingURL=main.7815f96e.chunk.js.map